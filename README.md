# 出席管理システム (Attendance System)

## データベースリセット機能

### 概要
このシステムには、データベースを初期状態にリセットする機能が追加されています。この機能により、テストや開発中にデータベースを素早くクリーンな状態に戻すことができます。

### 機能説明

#### 1. 初期データ
システムには以下の初期データが含まれています：

**教師アカウント:**
- ユーザーID: `teacher1` / パスワード: `password`
- ユーザーID: `teacher2` / パスワード: `password`

**学生アカウント:**
- ユーザーID: `student1` / パスワード: `password`
- ユーザーID: `student2` / パスワード: `password`
- ユーザーID: `student3` / パスワード: `password`
- ユーザーID: `student4` / パスワード: `password`
- ユーザーID: `student5` / パスワード: `password`

すべてのユーザーのメールアドレスは `{userId}@example.com` の形式です。

#### 2. サンプル出席データ
初期データには、いくつかの出席記録サンプルが含まれています：
- 出席 (ATTENDANCE)
- 欠席 (ABSENCE)
- 遅刻 (LATENESS)
- 早退 (EARLY)

### 使用方法

#### Webインターフェース経由
1. 教師アカウントでログインする
2. 教師メニュー画面に移動する
3. 「データベースをリセット」ボタンをクリックする
4. 確認ダイアログで「OK」をクリックする

#### API経由
教師権限を持つユーザーで認証した後、以下のエンドポイントにPOSTリクエストを送信します：

```bash
POST /admin/reset-database
```

**レスポンス:**
- 成功時: 200 OK - "データベースが正常にリセットされました"
- 失敗時: 500 Internal Server Error - エラーメッセージ

### セキュリティ

- データベースリセット機能は**教師権限を持つユーザーのみ**が実行可能です
- 学生アカウントではこの機能にアクセスできません
- Spring Securityの`@PreAuthorize`アノテーションにより保護されています

### 技術詳細

#### ファイル構成
```
src/main/resources/
  └── data-init.sql                    # 初期データSQLスクリプト

src/main/java/com/example/demo/
  ├── service/
  │   └── DatabaseResetService.java   # リセット処理を実行するサービス
  └── controller/
      └── DatabaseResetController.java # リセットAPIエンドポイント
```

#### データベーススキーマ
システムは以下のテーブルを使用します：
- `user` - ユーザー情報（教師・学生）
- `attendance` - 出席記録

リセット時は両方のテーブルのデータが削除され、初期データが再投入されます。

### 開発環境での使用

開発やテスト中にデータベースの状態を頻繁にリセットする必要がある場合、この機能を使用することで手動でのSQL実行やアプリケーションの再起動が不要になります。

### 注意事項

⚠️ **重要**: この機能は開発・テスト環境での使用を想定しています。本番環境で使用する場合は、以下の点に注意してください：

1. データベースリセットを実行すると、**すべての既存データが削除されます**
2. 削除されたデータは復元できません
3. 本番環境では、この機能へのアクセスを制限するか、機能を無効化することを推奨します

### カスタマイズ

初期データをカスタマイズする場合は、`src/main/resources/data-init.sql` ファイルを編集してください。

例：
```sql
-- 新しいユーザーを追加
INSERT INTO user (id, user_id, password, email, role, created_at, updated_at) VALUES
(8, 'student6', '$2a$10$EblZqNptyYvcLm/VwDCVAuBjzZOI7khzdyGPBr08PpIi0na624b8.', 
 'student6@example.com', 'STUDENT', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
```

### トラブルシューティング

**問題**: リセットボタンをクリックしてもエラーが発生する
- **解決策**: ログを確認してください。データベース接続やSQLスクリプトの構文エラーが原因の可能性があります

**問題**: 教師でログインしてもリセットボタンが動作しない
- **解決策**: ユーザーのロールが正しく設定されているか確認してください（`TEACHER`ロールである必要があります）

**問題**: SQLスクリプトの実行に失敗する
- **解決策**: `data-init.sql`の構文を確認してください。特にセミコロン(;)の位置に注意してください
